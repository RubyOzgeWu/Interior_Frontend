import{Q as qe,R as ot,r as st,b as le,h as rt,l as it,c as $}from"./QBtn.434b1d49.js";import{h as ut,d as B,e as E,Q as W}from"./QItem.a975a033.js";import{u as ze,Q as dt,c as Ae,d as Qe,e as Z,f as be,g as oe,a as he,b as Y,C as ee}from"./ClosePopup.067fd53f.js";import{Q as ge}from"./QList.408e1735.js";import{l as ue,A as ct,h as V,J as Ke,r as D,c as S,N as X,g as de,P as pt,L as te,X as vt,aa as ft,R as se,ab as ye,U as Ue,m as we,S as ke,w as mt,E as _t,an as Me,i as bt,Y as Ve,ao as We,W as ht,a4 as gt,n as re,a5 as yt,p as L,a2 as ie,u as r,x as c,f as t,a0 as x,ae as Ie,q as Ce,ad as Pe,F as Se,v as Be,a6 as H}from"./index.78cf9897.js";import{g as Oe,s as Ee,u as wt,Q as kt}from"./use-quasar.0e5d05e1.js";import{u as Vt,a as Ct}from"./use-dark.247310d6.js";import{Q as U}from"./QInput.f4a86df9.js";import{Q as Ne}from"./QForm.c35c0d0c.js";import{a as Fe,b as F}from"./user.49be3861.js";import{_ as Pt}from"./DoughnutChart.146723a0.js";var St=ue({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(e,{slots:p,emit:h}){let v=!1,d,n,s=null,b=null,w,i;function g(){d&&d(),d=null,v=!1,s!==null&&(clearTimeout(s),s=null),b!==null&&(clearTimeout(b),b=null),n!==void 0&&n.removeEventListener("transitionend",w),w=null}function C(f,u,m){u!==void 0&&(f.style.height=`${u}px`),f.style.transition=`height ${e.duration}ms cubic-bezier(.25, .8, .50, 1)`,v=!0,d=m}function k(f,u){f.style.overflowY=null,f.style.height=null,f.style.transition=null,g(),u!==i&&h(u)}function j(f,u){let m=0;n=f,v===!0?(g(),m=f.offsetHeight===f.scrollHeight?0:void 0):(i="hide",f.style.overflowY="hidden"),C(f,m,u),s=setTimeout(()=>{s=null,f.style.height=`${f.scrollHeight}px`,w=P=>{b=null,(Object(P)!==P||P.target===f)&&k(f,"show")},f.addEventListener("transitionend",w),b=setTimeout(w,e.duration*1.1)},100)}function A(f,u){let m;n=f,v===!0?g():(i="show",f.style.overflowY="hidden",m=f.scrollHeight),C(f,m,u),s=setTimeout(()=>{s=null,f.style.height=0,w=P=>{b=null,(Object(P)!==P||P.target===f)&&k(f,"hide")},f.addEventListener("transitionend",w),b=setTimeout(w,e.duration*1.1)},100)}return ct(()=>{v===!0&&g()}),()=>V(Ke,{css:!1,appear:e.appear,onEnter:j,onLeave:A},p.default)}}),Ye=ue({name:"StepHeader",props:{stepper:{},step:{},goToPanel:Function},setup(e,{attrs:p}){const{proxy:{$q:h}}=de(),v=D(null),d=S(()=>e.stepper.modelValue===e.step.name),n=S(()=>{const u=e.step.disable;return u===!0||u===""}),s=S(()=>{const u=e.step.error;return u===!0||u===""}),b=S(()=>{const u=e.step.done;return n.value===!1&&(u===!0||u==="")}),w=S(()=>{const u=e.step.headerNav,m=u===!0||u===""||u===void 0;return n.value===!1&&e.stepper.headerNav&&m}),i=S(()=>e.step.prefix&&(d.value===!1||e.stepper.activeIcon==="none")&&(s.value===!1||e.stepper.errorIcon==="none")&&(b.value===!1||e.stepper.doneIcon==="none")),g=S(()=>{const u=e.step.icon||e.stepper.inactiveIcon;if(d.value===!0){const m=e.step.activeIcon||e.stepper.activeIcon;return m==="none"?u:m||h.iconSet.stepper.active}if(s.value===!0){const m=e.step.errorIcon||e.stepper.errorIcon;return m==="none"?u:m||h.iconSet.stepper.error}if(n.value===!1&&b.value===!0){const m=e.step.doneIcon||e.stepper.doneIcon;return m==="none"?u:m||h.iconSet.stepper.done}return u}),C=S(()=>{const u=s.value===!0?e.step.errorColor||e.stepper.errorColor:void 0;if(d.value===!0){const m=e.step.activeColor||e.stepper.activeColor||e.step.color;return m!==void 0?m:u}return u!==void 0?u:n.value===!1&&b.value===!0?e.step.doneColor||e.stepper.doneColor||e.step.color||e.stepper.inactiveColor:e.step.color||e.stepper.inactiveColor}),k=S(()=>"q-stepper__tab col-grow flex items-center no-wrap relative-position"+(C.value!==void 0?` text-${C.value}`:"")+(s.value===!0?" q-stepper__tab--error q-stepper__tab--error-with-"+(i.value===!0?"prefix":"icon"):"")+(d.value===!0?" q-stepper__tab--active":"")+(b.value===!0?" q-stepper__tab--done":"")+(w.value===!0?" q-stepper__tab--navigation q-focusable q-hoverable":"")+(n.value===!0?" q-stepper__tab--disabled":"")),j=S(()=>e.stepper.headerNav!==!0?!1:w.value);function A(){v.value!==null&&v.value.focus(),d.value===!1&&e.goToPanel(e.step.name)}function f(u){u.keyCode===13&&d.value===!1&&e.goToPanel(e.step.name)}return()=>{const u={class:k.value};w.value===!0&&(u.onClick=A,u.onKeyup=f,Object.assign(u,n.value===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:p.tabindex||0}));const m=[V("div",{class:"q-focus-helper",tabindex:-1,ref:v}),V("div",{class:"q-stepper__dot row flex-center q-stepper__line relative-position"},[V("span",{class:"row flex-center"},[i.value===!0?e.step.prefix:V(qe,{name:g.value})])])];if(e.step.title!==void 0&&e.step.title!==null){const P=[V("div",{class:"q-stepper__title"},e.step.title)];e.step.caption!==void 0&&e.step.caption!==null&&P.push(V("div",{class:"q-stepper__caption"},e.step.caption)),m.push(V("div",{class:"q-stepper__label q-stepper__line relative-position"},P))}return X(V("div",u,m),[[ot,j.value]])}}});function qt(e){const p=[.06,6,50];return typeof e=="string"&&e.length&&e.split(":").forEach((h,v)=>{const d=parseFloat(h);d&&(p[v]=d)}),p}var xt=pt({name:"touch-swipe",beforeMount(e,{value:p,arg:h,modifiers:v}){if(v.mouse!==!0&&te.has.touch!==!0)return;const d=v.mouseCapture===!0?"Capture":"",n={handler:p,sensitivity:qt(h),direction:Oe(v),noop:vt,mouseStart(s){Ee(s,n)&&ft(s)&&(se(n,"temp",[[document,"mousemove","move",`notPassive${d}`],[document,"mouseup","end","notPassiveCapture"]]),n.start(s,!0))},touchStart(s){if(Ee(s,n)){const b=s.target;se(n,"temp",[[b,"touchmove","move","notPassiveCapture"],[b,"touchcancel","end","notPassiveCapture"],[b,"touchend","end","notPassiveCapture"]]),n.start(s)}},start(s,b){te.is.firefox===!0&&ye(e,!0);const w=Ue(s);n.event={x:w.left,y:w.top,time:Date.now(),mouse:b===!0,dir:!1}},move(s){if(n.event===void 0)return;if(n.event.dir!==!1){we(s);return}const b=Date.now()-n.event.time;if(b===0)return;const w=Ue(s),i=w.left-n.event.x,g=Math.abs(i),C=w.top-n.event.y,k=Math.abs(C);if(n.event.mouse!==!0){if(g<n.sensitivity[1]&&k<n.sensitivity[1]){n.end(s);return}}else if(window.getSelection().toString()!==""){n.end(s);return}else if(g<n.sensitivity[2]&&k<n.sensitivity[2])return;const j=g/b,A=k/b;n.direction.vertical===!0&&g<k&&g<100&&A>n.sensitivity[0]&&(n.event.dir=C<0?"up":"down"),n.direction.horizontal===!0&&g>k&&k<100&&j>n.sensitivity[0]&&(n.event.dir=i<0?"left":"right"),n.direction.up===!0&&g<k&&C<0&&g<100&&A>n.sensitivity[0]&&(n.event.dir="up"),n.direction.down===!0&&g<k&&C>0&&g<100&&A>n.sensitivity[0]&&(n.event.dir="down"),n.direction.left===!0&&g>k&&i<0&&k<100&&j>n.sensitivity[0]&&(n.event.dir="left"),n.direction.right===!0&&g>k&&i>0&&k<100&&j>n.sensitivity[0]&&(n.event.dir="right"),n.event.dir!==!1?(we(s),n.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),ut(),n.styleCleanup=f=>{n.styleCleanup=void 0,document.body.classList.remove("non-selectable");const u=()=>{document.body.classList.remove("no-pointer-events--children")};f===!0?setTimeout(u,50):u()}),n.handler({evt:s,touch:n.event.mouse!==!0,mouse:n.event.mouse,direction:n.event.dir,duration:b,distance:{x:g,y:k}})):n.end(s)},end(s){n.event!==void 0&&(ke(n,"temp"),te.is.firefox===!0&&ye(e,!1),n.styleCleanup!==void 0&&n.styleCleanup(!0),s!==void 0&&n.event.dir!==!1&&we(s),n.event=void 0)}};if(e.__qtouchswipe=n,v.mouse===!0){const s=v.mouseCapture===!0||v.mousecapture===!0?"Capture":"";se(n,"main",[[e,"mousedown","mouseStart",`passive${s}`]])}te.has.touch===!0&&se(n,"main",[[e,"touchstart","touchStart",`passive${v.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,p){const h=e.__qtouchswipe;h!==void 0&&(p.oldValue!==p.value&&(typeof p.value!="function"&&h.end(),h.handler=p.value),h.direction=Oe(p.modifiers))},beforeUnmount(e){const p=e.__qtouchswipe;p!==void 0&&(ke(p,"main"),ke(p,"temp"),te.is.firefox===!0&&ye(e,!1),p.styleCleanup!==void 0&&p.styleCleanup(),delete e.__qtouchswipe)}});const Dt={name:{required:!0},disable:Boolean},Re={setup(e,{slots:p}){return()=>V("div",{class:"q-panel scroll",role:"tabpanel"},le(p.default))}},jt={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},$t=["update:modelValue","beforeTransition","transition"];function Tt(){const{props:e,emit:p,proxy:h}=de(),{getCache:v}=ze();let d,n;const s=D(null),b=D(null);function w(_){const q=e.vertical===!0?"up":"left";R((h.$q.lang.rtl===!0?-1:1)*(_.direction===q?1:-1))}const i=S(()=>[[xt,w,void 0,{horizontal:e.vertical!==!0,vertical:e.vertical,mouse:!0}]]),g=S(()=>e.transitionPrev||`slide-${e.vertical===!0?"down":"right"}`),C=S(()=>e.transitionNext||`slide-${e.vertical===!0?"up":"left"}`),k=S(()=>`--q-transition-duration: ${e.transitionDuration}ms`),j=S(()=>typeof e.modelValue=="string"||typeof e.modelValue=="number"?e.modelValue:String(e.modelValue)),A=S(()=>({include:e.keepAliveInclude,exclude:e.keepAliveExclude,max:e.keepAliveMax})),f=S(()=>e.keepAliveInclude!==void 0||e.keepAliveExclude!==void 0);mt(()=>e.modelValue,(_,q)=>{const I=T(_)===!0?J(_):-1;n!==!0&&y(I===-1?0:I<J(q)?-1:1),s.value!==I&&(s.value=I,p("beforeTransition",_,q),_t(()=>{p("transition",_,q)}))});function u(){R(1)}function m(){R(-1)}function P(_){p("update:modelValue",_)}function T(_){return _!=null&&_!==""}function J(_){return d.findIndex(q=>q.props.name===_&&q.props.disable!==""&&q.props.disable!==!0)}function ce(){return d.filter(_=>_.props.disable!==""&&_.props.disable!==!0)}function y(_){const q=_!==0&&e.animated===!0&&s.value!==-1?"q-transition--"+(_===-1?g.value:C.value):null;b.value!==q&&(b.value=q)}function R(_,q=s.value){let I=q+_;for(;I!==-1&&I<d.length;){const z=d[I];if(z!==void 0&&z.props.disable!==""&&z.props.disable!==!0){y(_),n=!0,p("update:modelValue",z.props.name),setTimeout(()=>{n=!1});return}I+=_}e.infinite===!0&&d.length!==0&&q!==-1&&q!==d.length&&R(_,_===-1?d.length:-1)}function G(){const _=J(e.modelValue);return s.value!==_&&(s.value=_),!0}function ae(){const _=T(e.modelValue)===!0&&G()&&d[s.value];return e.keepAlive===!0?[V(Me,A.value,[V(f.value===!0?v(j.value,()=>({...Re,name:j.value})):Re,{key:j.value,style:k.value},()=>_)])]:[V("div",{class:"q-panel scroll",style:k.value,key:j.value,role:"tabpanel"},[_])]}function pe(){if(d.length!==0)return e.animated===!0?[V(Ke,{name:b.value},ae)]:ae()}function ve(_){return d=st(le(_.default,[])).filter(q=>q.props!==null&&q.props.slot===void 0&&T(q.props.name)===!0),d.length}function fe(){return d}return Object.assign(h,{next:u,previous:m,goTo:P}),{panelIndex:s,panelDirectives:i,updatePanelsList:ve,updatePanelIndex:G,getPanelContent:pe,getEnabledPanels:ce,getPanels:fe,isValidPanelName:T,keepAliveProps:A,needsUniqueKeepAliveWrapper:f,goToPanelByOffset:R,goToPanel:P,nextPanel:u,previousPanel:m}}function He(e){return V("div",{class:"q-stepper__step-content"},[V("div",{class:"q-stepper__step-inner"},le(e.default))])}const Le={setup(e,{slots:p}){return()=>He(p)}};var At=ue({name:"QStep",props:{...Dt,icon:String,color:String,title:{type:String,required:!0},caption:String,prefix:[String,Number],doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String,headerNav:{type:Boolean,default:!0},done:Boolean,error:Boolean,onScroll:[Function,Array]},setup(e,{slots:p,emit:h}){const{proxy:{$q:v}}=de(),d=bt(We,Ve);if(d===Ve)return console.error("QStep needs to be a child of QStepper"),Ve;const{getCache:n}=ze(),s=D(null),b=S(()=>d.value.modelValue===e.name),w=S(()=>v.platform.is.ios!==!0&&v.platform.is.chrome===!0||b.value!==!0||d.value.vertical!==!0?{}:{onScroll(C){const{target:k}=C;k.scrollTop>0&&(k.scrollTop=0),e.onScroll!==void 0&&h("scroll",C)}}),i=S(()=>typeof e.name=="string"||typeof e.name=="number"?e.name:String(e.name));function g(){const C=d.value.vertical;return C===!0&&d.value.keepAlive===!0?V(Me,d.value.keepAliveProps.value,b.value===!0?[V(d.value.needsUniqueKeepAliveWrapper.value===!0?n(i.value,()=>({...Le,name:i.value})):Le,{key:i.value},p.default)]:void 0):C!==!0||b.value===!0?He(p):void 0}return()=>V("div",{ref:s,class:"q-stepper__step",role:"tabpanel",...w.value},d.value.vertical===!0?[V(Ye,{stepper:d.value,step:e,goToPanel:d.value.goToPanel}),d.value.animated===!0?V(St,g):g()]:[g()])}});const Qt=/(-\w)/g;function Ut(e){const p={};for(const h in e){const v=h.replace(Qt,d=>d[1].toUpperCase());p[v]=e[h]}return p}var It=ue({name:"QStepper",props:{...Vt,...jt,flat:Boolean,bordered:Boolean,alternativeLabels:Boolean,headerNav:Boolean,contracted:Boolean,headerClass:String,inactiveColor:String,inactiveIcon:String,doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String},emits:$t,setup(e,{slots:p}){const h=de(),v=Ct(e,h.proxy.$q),{updatePanelsList:d,isValidPanelName:n,updatePanelIndex:s,getPanelContent:b,getPanels:w,panelDirectives:i,goToPanel:g,keepAliveProps:C,needsUniqueKeepAliveWrapper:k}=Tt();ht(We,S(()=>({goToPanel:g,keepAliveProps:C,needsUniqueKeepAliveWrapper:k,...e})));const j=S(()=>`q-stepper q-stepper--${e.vertical===!0?"vertical":"horizontal"}`+(e.flat===!0?" q-stepper--flat":"")+(e.bordered===!0?" q-stepper--bordered":"")+(v.value===!0?" q-stepper--dark q-dark":"")),A=S(()=>`q-stepper__header row items-stretch justify-between q-stepper__header--${e.alternativeLabels===!0?"alternative":"standard"}-labels`+(e.flat===!1||e.bordered===!0?" q-stepper__header--border":"")+(e.contracted===!0?" q-stepper__header--contracted":"")+(e.headerClass!==void 0?` ${e.headerClass}`:""));function f(){const u=le(p.message,[]);if(e.vertical===!0){n(e.modelValue)&&s();const m=V("div",{class:"q-stepper__content"},le(p.default));return u===void 0?[m]:u.concat(m)}return[V("div",{class:A.value},w().map(m=>{const P=Ut(m.props);return V(Ye,{key:P.name,stepper:e,step:P,goToPanel:g})})),u,it("div",{class:"q-stepper__content q-panel-parent"},b(),"cont",e.swipeable,()=>i.value)]}return()=>(d(p),V("div",{class:j.value},rt(p.navigation,f())))}});const Bt={id:"project-control",class:"column"},Ot={class:"header col-1"},Et=c("h5",null,"\u5C08\u6848\u63A7\u5236\u53F0",-1),Nt=c("span",null,"\u516C\u544A\u6B04",-1),Ft={class:"content col-11"},Rt={class:"project-wrapper"},Lt={class:"info row"},zt={class:"row col-12 project-title"},Kt={class:"project-name"},Mt={class:"column col-6"},Wt={class:"project-date col"},Yt={class:"project-owner col column"},Ht={class:"column col-6"},Xt={class:"project-address col"},Jt={class:"project-client col"},Gt={class:"project-phone col"},Zt={class:"complete-container"},el={class:"btn-add"},tl={class:"task-date col-12"},ll={class:"task-status"},al={class:"task-owner"},nl={class:"bulletin-board-wrapper"},ol={class:"bulletin-header row justify-between items-center"},sl=c("h5",null,"\u516C\u544A\u6B04",-1),rl={class:"bulletin-content"},il={class:"announcement-header row justify-between items-center"},ul={class:"announcement-title"},dl={class:"announcement-content"},cl={class:"bulletin-header row justify-between items-center"},pl=c("h5",null,"\u516C\u544A\u6B04",-1),vl={class:"bulletin-content"},fl={class:"announcement-header row justify-between items-center"},ml={class:"announcement-title"},_l={class:"announcement-content"},bl=c("div",{class:"text-h4",style:{"font-weight":"700",color:"#2466e2"}}," \u7DE8\u8F2F\u5C08\u6848 ",-1),hl={class:"row items-center justify-end"},gl={class:"text-h4",style:{"font-weight":"700",color:"#2466e2"}},yl={class:"row items-center justify-end"},wl={class:"text-h4",style:{"font-weight":"700",color:"#2466e2"}},kl={class:"title",style:{"font-weight":"700",color:"black"}},Vl={class:"content"},Ul={__name:"ProjectControl",setup(e){const p=gt(),h=D(""),v=re({required(o){return!!o||"\u5FC5\u586B"}}),d=D(null),n=D(null),s=D({owner:{label:"",value:""},_id:"",name:"",date:"",status:"\u6E96\u5099\u4E2D",phase:"",client:"",address:"",phone:"",budget:"",remark:"",announcements:[],__v:0}),b=o=>new Date(o).toLocaleDateString(),w=D(!1),i=re({_id:"",name:"",date:"2024/02/01",status:"\u6E96\u5099\u4E2D",phase:"",owner:"",client:"",phone:"",address:"",budget:"",remark:""}),g=D([]),C=["\u6E96\u5099\u4E2D","\u9032\u884C\u4E2D","\u5DF2\u5B8C\u6210","\u5DF2\u903E\u671F"],k=["\u63D0\u6848\u968E\u6BB5","\u8A2D\u8A08\u968E\u6BB5","\u5DE5\u7A0B\u968E\u6BB5"],j=o=>{A(o),w.value=!0},A=o=>{for(const l in i)Object.prototype.hasOwnProperty.call(i,l)&&Object.prototype.hasOwnProperty.call(o,l)&&(i[l]=o[l])},f=async()=>{const o={name:i.name,date:i.date,status:i.status,phase:i.phase,owner:{label:i.owner.label,value:i.owner.value},client:i.client,phone:i.phone,address:i.address,budget:i.budget,remark:i.remark};try{await F.patch(`/projects/${i._id}`,o),alert("\u5132\u5B58\u6210\u529F"),w.value=!1,await N()}catch{alert("\u5132\u5B58\u5931\u6557")}},u=o=>({"status-preparing":o==="\u6E96\u5099\u4E2D","status-in-progress":o==="\u9032\u884C\u4E2D","status-done":o==="\u5DF2\u5B8C\u6210","status-expired":o==="\u5DF2\u903E\u671F"}),m=D([]),P=D(!1),T=D(!1),J=o=>{T.value=!1,ce(),i.phase=o,P.value=!0},ce=()=>{y._id="",y.name="",y.date="2024/02/01",y.status="\u6E96\u5099\u4E2D",y.owner="",y.remark=""},y=re({_id:"",name:"",date:"2024/02/01",status:"\u6E96\u5099\u4E2D",owner:"",remark:""}),R=()=>{m.value.sort((o,l)=>new Date(o.date)-new Date(l.date))},G=()=>{d.value.validate().then(o=>{o&&(T.value?fe():ae(h.value))}).catch(o=>{console.error("\u8868\u55AE\u9A57\u8B49\u5931\u6557:",o)})},ae=async o=>{try{await F.post(`/projects/${o}/tasks`,y),alert("\u65B0\u589E\u6210\u529F"),await N(),P.value=!1}catch{alert("\u65B0\u589E\u5931\u6557")}},pe=o=>{console.log(o),T.value=!0,ve(o),P.value=!0},ve=o=>{for(const l in y)Object.prototype.hasOwnProperty.call(y,l)&&Object.prototype.hasOwnProperty.call(o,l)&&(y[l]=o[l])},fe=async()=>{const o={_id:y._id,name:y.name,date:y.date,status:y.status,owner:{label:y.owner.label,value:y.owner.value},remark:y.remark};console.log(o);try{await F.patch(`/projects/${h.value}/tasks/${y._id}`,o),alert("\u5132\u5B58\u6210\u529F"),P.value=!1,await N()}catch{alert("\u5132\u5B58\u5931\u6557")}},_=o=>{confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u4EFB\u52D9 "${o.name}" \uFF1F`)&&q(o._id)},q=async o=>{try{await F.delete(`/projects/${h.value}/tasks/${o}`),alert("\u522A\u9664\u6210\u529F"),await N()}catch(l){console.log(l),alert("\u522A\u9664\u5931\u6557")}},I=yt(),z=(o,l)=>{I.push(`/TaskControl/project/${o}/tasks/${l._id}`)},Xe=wt(),ne=D(!Xe.screen.lt.lg);function Je(){ne.value=!ne.value}const xe=()=>{n.value.validate().then(o=>{o&&(T.value?tt():Ze())}).catch(o=>{console.error("\u8868\u55AE\u9A57\u8B49\u5931\u6557:",o)})},K=D(!1),Q=re({_id:"",title:"",content:""}),De=()=>{T.value=!1,Ge(),K.value=!0},Ge=()=>{Q.title="",Q.content=""},Ze=async()=>{try{await F.post(`/projects/${h.value}/announcements`,Q),alert("\u65B0\u589E\u6210\u529F"),await N(),K.value=!1}catch{alert("\u65B0\u589E\u5931\u6557")}},je=o=>{T.value=!0,et(o),K.value=!0},et=o=>{for(const l in Q)Object.prototype.hasOwnProperty.call(Q,l)&&Object.prototype.hasOwnProperty.call(o,l)&&(Q[l]=o[l]);o.id&&(Q._id=o.id)},tt=async()=>{const o={id:Q._id,title:Q.title,content:Q.content};try{await F.patch(`/projects/${h.value}/announcements`,o),alert("\u5132\u5B58\u6210\u529F"),K.value=!1,await N()}catch{alert("\u5132\u5B58\u5931\u6557")}},$e=o=>{confirm("\u78BA\u5B9A\u8981\u522A\u9664\u516C\u544A\uFF1F")&&lt(h.value,o.id)},lt=async(o,l)=>{try{await F.delete(`/projects/${o}/announcements/${l}`),alert("\u522A\u9664\u6210\u529F"),await N()}catch(a){console.log(a),alert("\u522A\u9664\u5931\u6557")}},me=D(!1),_e=D({title:"",content:""}),Te=o=>{_e.value=o,me.value=!0},N=async()=>{try{const{data:o}=await Fe.get("/projects/"+p.params.id);s.value=o.result,h.value=o.result._id;const[l,a]=await Promise.all([F.get("/users/all"),Fe.get(`/projects/${h.value}/tasks/all`)]),at=l.data.result.map(M=>({label:M.account,value:M._id}));g.value=at;const nt=a.data;m.value=nt.result,console.log(m.value),R(),o.result.announcements&&(s.value.announcements=o.result.announcements.map(M=>({id:M._id,title:M.title,content:M.content})))}catch{alert("\u8F09\u5165\u932F\u8AA4")}};return N(),(o,l)=>(L(),ie(dt,null,{default:r(()=>[c("div",Bt,[c("div",Ot,[Et,t($,{class:"btn-bulletin",onClick:Je,icon:"assignment"},{default:r(()=>[Nt]),_:1})]),c("div",Ft,[c("div",Rt,[t(E,{class:"project-info",flat:""},{default:r(()=>[t($,{icon:"edit",onClick:l[0]||(l[0]=a=>j(s.value)),flat:"",dense:"",round:""}),t(B,null,{default:r(()=>[c("div",Lt,[c("div",zt,[c("span",Kt,x(s.value.name),1),c("span",{class:Ie(["project-status",u(s.value.status)])},x(s.value.status),3)]),c("div",Mt,[c("div",Wt,x(b(s.value.date)),1),c("div",Yt,x(s.value.owner.label),1)]),c("div",Ht,[c("div",Xt,x(s.value.address),1),c("div",Jt,x(s.value.client),1),c("div",Gt,x(s.value.phone),1)])]),c("div",Zt,[t(Pt,{phase:s.value.phase},null,8,["phase"])])]),_:1})]),_:1}),c("div",el,[t($,{icon:"add",flat:"",dense:"",round:"",onClick:J})]),t(E,{class:"tasks-container",flat:""},{default:r(()=>[t(It,{modelValue:o.step,"onUpdate:modelValue":l[1]||(l[1]=a=>o.step=a),vertical:"",color:"primary"},{default:r(()=>[(L(!0),Ce(Se,null,Pe(m.value,a=>(L(),ie(At,{icon:"settings",key:a._id,title:a.name},{default:r(()=>[t(E,{class:"task-card row",onDblclick:O=>z(h.value,a)},{default:r(()=>[c("p",tl,x(a.date),1),t($,{color:"grey-7",round:"",flat:"",icon:"more_horiz",class:"btn-menu"},{default:r(()=>[t(he,{cover:"","auto-close":""},{default:r(()=>[t(ge,null,{default:r(()=>[t(W,{clickable:"",onClick:O=>pe(a)},{default:r(()=>[t(Y,null,{default:r(()=>[H("\u7DE8\u8F2F")]),_:1})]),_:2},1032,["onClick"]),t(W,{clickable:"",onClick:O=>_(a)},{default:r(()=>[t(Y,null,{default:r(()=>[H("\u522A\u9664")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),c("p",ll,[c("span",{class:Ie(u(a.status))},x(a.status),3)]),c("p",al,x(a.owner.label),1)]),_:2},1032,["onDblclick"])]),_:2},1032,["title"]))),128))]),_:1},8,["modelValue"])]),_:1})]),c("div",nl,[c("div",ol,[sl,t($,{icon:"add",flat:"",dense:"",round:"",onClick:De})]),c("div",rl,[(L(!0),Ce(Se,null,Pe(s.value.announcements,a=>(L(),ie(E,{class:"announcement-card",key:a.title,flat:"",onDblclick:O=>Te(a)},{default:r(()=>[t(B,null,{default:r(()=>[c("div",il,[c("p",ul,x(a.title),1),t($,{color:"grey-7",round:"",flat:"",icon:"more_horiz",class:"btn-menu"},{default:r(()=>[t(he,{cover:"","auto-close":""},{default:r(()=>[t(ge,null,{default:r(()=>[t(W,{clickable:"",onClick:O=>je(a)},{default:r(()=>[t(Y,null,{default:r(()=>[H("\u7DE8\u8F2F")]),_:1})]),_:2},1032,["onClick"]),t(W,{clickable:"",onClick:O=>$e(a)},{default:r(()=>[t(Y,null,{default:r(()=>[H("\u522A\u9664")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),c("div",dl,x(a.content),1)]),_:2},1024)]),_:2},1032,["onDblclick"]))),128))])])]),t(kt,{modelValue:ne.value,"onUpdate:modelValue":l[2]||(l[2]=a=>ne.value=a),side:"right",bordered:"",width:500,class:"pad-bulletin-board-wrapper"},{default:r(()=>[c("div",cl,[pl,t($,{icon:"add",flat:"",dense:"",round:"",onClick:De})]),c("div",vl,[(L(!0),Ce(Se,null,Pe(s.value.announcements,a=>(L(),ie(E,{class:"announcement-card",key:a.title,flat:"",onDblclick:O=>Te(a)},{default:r(()=>[t(B,null,{default:r(()=>[c("div",fl,[c("p",ml,x(a.title),1),t($,{color:"grey-7",round:"",flat:"",icon:"more_horiz",class:"btn-menu"},{default:r(()=>[t(he,{cover:"","auto-close":""},{default:r(()=>[t(ge,null,{default:r(()=>[t(W,{clickable:"",onClick:O=>je(a)},{default:r(()=>[t(Y,null,{default:r(()=>[H("\u7DE8\u8F2F")]),_:1})]),_:2},1032,["onClick"]),t(W,{clickable:"",onClick:O=>$e(a)},{default:r(()=>[t(Y,null,{default:r(()=>[H("\u522A\u9664")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),c("div",_l,x(a.content),1)]),_:2},1024)]),_:2},1032,["onDblclick"]))),128))])]),_:1},8,["modelValue"])]),t(oe,{modelValue:w.value,"onUpdate:modelValue":l[15]||(l[15]=a=>w.value=a),persistent:""},{default:r(()=>[t(E,{class:"add-form"},{default:r(()=>[t(B,null,{default:r(()=>[bl]),_:1}),t(B,null,{default:r(()=>[t(U,{modelValue:i.name,"onUpdate:modelValue":l[3]||(l[3]=a=>i.name=a),label:"\u5C08\u6848\u540D\u7A31",rules:[v.required]},null,8,["modelValue","rules"]),t(U,{modelValue:i.date,"onUpdate:modelValue":l[5]||(l[5]=a=>i.date=a),mask:"date",rules:["date"]},{append:r(()=>[t(qe,{name:"event",class:"cursor-pointer"},{default:r(()=>[t(Ae,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[t(Qe,{modelValue:i.date,"onUpdate:modelValue":l[4]||(l[4]=a=>i.date=a)},{default:r(()=>[c("div",hl,[X(t($,{label:"Close",color:"primary",flat:""},null,512),[[ee]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Z,{modelValue:i.status,"onUpdate:modelValue":l[6]||(l[6]=a=>i.status=a),label:"\u5C08\u6848\u72C0\u614B",options:C,rules:[v.required]},null,8,["modelValue","rules"]),t(Z,{modelValue:i.phase,"onUpdate:modelValue":l[7]||(l[7]=a=>i.phase=a),label:"\u5C08\u6848\u968E\u6BB5",options:k,rules:[v.required]},null,8,["modelValue","rules"]),t(Z,{modelValue:i.owner,"onUpdate:modelValue":l[8]||(l[8]=a=>i.owner=a),label:"\u5C08\u6848\u4E3B\u7BA1",options:g.value,rules:[v.required]},null,8,["modelValue","options","rules"]),t(U,{modelValue:i.client,"onUpdate:modelValue":l[9]||(l[9]=a=>i.client=a),label:"\u696D\u4E3B\u59D3\u540D",rules:[v.required]},null,8,["modelValue","rules"]),t(U,{modelValue:i.phone,"onUpdate:modelValue":l[10]||(l[10]=a=>i.phone=a),label:"\u696D\u4E3B\u96FB\u8A71",rules:[v.required]},null,8,["modelValue","rules"]),t(U,{modelValue:i.address,"onUpdate:modelValue":l[11]||(l[11]=a=>i.address=a),label:"\u5C08\u6848\u5730\u5740",rules:[v.required]},null,8,["modelValue","rules"]),t(U,{modelValue:i.budget,"onUpdate:modelValue":l[12]||(l[12]=a=>i.budget=a),label:"\u5C08\u6848\u9810\u7B97",rules:[v.required]},null,8,["modelValue","rules"]),t(U,{modelValue:i.remark,"onUpdate:modelValue":l[13]||(l[13]=a=>i.remark=a),label:"\u5099\u8A3B",type:"textarea",clearable:""},null,8,["modelValue"])]),_:1}),t(be,{align:"right"},{default:r(()=>[X(t($,{class:"btn-cancel",flat:"",label:"\u53D6\u6D88"},null,512),[[ee]]),t($,{class:"btn-save",flat:"",label:"\u5132\u5B58",onClick:l[14]||(l[14]=a=>f())})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(oe,{modelValue:P.value,"onUpdate:modelValue":l[22]||(l[22]=a=>P.value=a),persistent:""},{default:r(()=>[t(E,{class:"add-form"},{default:r(()=>[t(B,null,{default:r(()=>[c("div",gl,x(T.value?"\u7DE8\u8F2F\u4EFB\u52D9":"\u65B0\u589E\u4EFB\u52D9"),1)]),_:1}),t(Ne,{ref_key:"taskFormRef",ref:d,onSubmit:Be(G,["prevent"])},{default:r(()=>[t(B,null,{default:r(()=>[t(U,{modelValue:y.name,"onUpdate:modelValue":l[16]||(l[16]=a=>y.name=a),label:"\u4EFB\u52D9\u540D\u7A31",rules:[v.required]},null,8,["modelValue","rules"]),t(U,{modelValue:y.date,"onUpdate:modelValue":l[18]||(l[18]=a=>y.date=a),mask:"date",rules:["date"]},{append:r(()=>[t(qe,{name:"event",class:"cursor-pointer"},{default:r(()=>[t(Ae,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[t(Qe,{modelValue:y.date,"onUpdate:modelValue":l[17]||(l[17]=a=>y.date=a)},{default:r(()=>[c("div",yl,[X(t($,{label:"Close",color:"primary",flat:""},null,512),[[ee]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Z,{modelValue:y.status,"onUpdate:modelValue":l[19]||(l[19]=a=>y.status=a),label:"\u4EFB\u52D9\u72C0\u614B",options:C,rules:[v.required]},null,8,["modelValue","rules"]),t(Z,{modelValue:y.owner,"onUpdate:modelValue":l[20]||(l[20]=a=>y.owner=a),label:"\u4EFB\u52D9\u8CA0\u8CAC\u4EBA",options:g.value,rules:[v.required]},null,8,["modelValue","options","rules"]),t(U,{modelValue:y.remark,"onUpdate:modelValue":l[21]||(l[21]=a=>y.remark=a),label:"\u5099\u8A3B",type:"textarea",clearable:""},null,8,["modelValue"])]),_:1}),t(be,{align:"right"},{default:r(()=>[X(t($,{class:"btn-cancel",flat:"",label:"\u53D6\u6D88"},null,512),[[ee]]),t($,{class:"btn-save",flat:"",label:T.value?"\u5132\u5B58":"\u65B0\u589E",onClick:G},null,8,["label"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"]),t(oe,{modelValue:K.value,"onUpdate:modelValue":l[25]||(l[25]=a=>K.value=a),persistent:""},{default:r(()=>[t(E,{class:"add-form bulletin-dialog"},{default:r(()=>[t(B,null,{default:r(()=>[c("div",wl,x(T.value?"\u7DE8\u8F2F\u516C\u544A":"\u65B0\u589E\u516C\u544A"),1)]),_:1}),t(Ne,{ref_key:"BulletinBoardRef",ref:n,onSubmit:Be(xe,["prevent"])},{default:r(()=>[t(B,null,{default:r(()=>[t(U,{modelValue:Q.title,"onUpdate:modelValue":l[23]||(l[23]=a=>Q.title=a),label:"\u6A19\u984C",rules:[v.required]},null,8,["modelValue","rules"]),t(U,{modelValue:Q.content,"onUpdate:modelValue":l[24]||(l[24]=a=>Q.content=a),label:"\u5167\u5BB9",type:"textarea",clearable:"","input-class":"custom-textarea",rules:[v.required]},null,8,["modelValue","rules"])]),_:1}),t(be,{align:"right"},{default:r(()=>[X(t($,{class:"btn-cancel",flat:"",label:"\u53D6\u6D88"},null,512),[[ee]]),t($,{class:"btn-save",flat:"",label:T.value?"\u5132\u5B58":"\u65B0\u589E",onClick:xe},null,8,["label"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"]),t(oe,{modelValue:me.value,"onUpdate:modelValue":l[26]||(l[26]=a=>me.value=a)},{default:r(()=>[t(E,{class:"announcement-board"},{default:r(()=>[t(B,null,{default:r(()=>[c("h4",kl,x(_e.value.title),1),c("div",Vl,x(_e.value.content),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ul as default};
