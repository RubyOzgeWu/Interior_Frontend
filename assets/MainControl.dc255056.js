import{Q as me,a as D,b as i,c as ve,d as fe,e as E,f as he,g as ke,C as J}from"./ClosePopup.067fd53f.js";import{Q as _,d as r,e as p}from"./QItem.a975a033.js";import{Q as $}from"./QList.408e1735.js";import{c as f,Q as C}from"./QBtn.434b1d49.js";import{Q as m}from"./QInput.f4a86df9.js";import{b as Q,a as be}from"./user.49be3861.js";import{_ as Ve}from"./DoughnutChart.146723a0.js";import{r as v,n as we,c as V,a5 as ge,p as h,a2 as U,u as a,x as e,f as s,a6 as u,a0 as d,q as L,ad as R,F as M,N as W,ae as T}from"./index.78cf9897.js";import"./use-dark.247310d6.js";const Ce={id:"projects-wrapper"},je=e("h5",null,"\u4E3B\u8981\u63A7\u5236\u53F0",-1),Pe={class:"filter"},ye={class:"projects-container proposed"},De={class:"projects-show"},$e={class:"info"},Qe=e("p",null,"\u5DF2\u63D0\u6848",-1),Ue={class:"row"},xe={class:"projects-amount"},Oe=e("div",null,[e("span",null,"\u5DF2\u63D0\u6848")],-1),Be={class:"projects"},Se={class:"col col-10"},Ie={class:"project-name"},Ae={class:"project-date"},Fe={class:"project-status"},ze={class:"col col-2"},Ne={class:"projects-container design"},Ee={class:"projects-show"},Le={class:"info"},Re=e("p",null,"\u8A2D\u8A08\u968E\u6BB5",-1),Me={class:"row"},Te={class:"projects-amount"},qe=e("div",null,[e("span",null,"\u8A2D\u8A08\u4E2D")],-1),Ke={class:"projects"},Ge={class:"col col-10"},He={class:"project-name"},Je={class:"project-date"},We={class:"project-status"},Xe={class:"col col-2"},Ye={class:"projects-container construction"},Ze={class:"projects-show"},et={class:"info"},tt=e("p",null,"\u5DE5\u7A0B\u968E\u6BB5",-1),st={class:"row"},lt={class:"projects-amount"},at=e("div",null,[e("span",null,"\u5DE5\u7A0B\u4E2D")],-1),ot={class:"projects"},nt={class:"col col-10"},dt={class:"project-name"},ct={class:"project-date"},rt={class:"project-status"},ut={class:"col col-2"},it={class:"complete-container"},_t=e("h6",null,"\u5C08\u6848\u5B8C\u6210\u5EA6",-1),pt={class:"selectedProject"},mt={class:"selectedProject-name"},vt={class:"selectedProject-table"},ft={class:"selectedProject-address"},ht=e("td",null,"\u5730\u5740\uFF1A",-1),kt={class:"selectedProject-client"},bt=e("td",null,"\u696D\u4E3B\uFF1A",-1),Vt={class:"selectedProject-phone"},wt=e("td",null,"\u806F\u7D61\u96FB\u8A71\uFF1A",-1),gt={class:"selectedProject-budget"},Ct=e("td",null,"\u9810\u7B97\uFF1A",-1),jt={class:"text-h4",style:{"font-weight":"700",color:"#2466e2"}},Pt={class:"row items-center justify-end"},At={__name:"MainControl",setup(yt){const w=v([]),o=we({_id:"",name:"",date:"2024/02/01",status:"\u6E96\u5099\u4E2D",phase:"",owner:"",client:"",phone:"",address:"",budget:"",remark:""}),q=v([]),X=["\u6E96\u5099\u4E2D","\u9032\u884C\u4E2D","\u5DF2\u5B8C\u6210","\u5DF2\u903E\u671F"],Y=["\u63D0\u6848\u968E\u6BB5","\u8A2D\u8A08\u968E\u6BB5","\u5DE5\u7A0B\u968E\u6BB5"],k=v(!1),g=v(!1),x=n=>{g.value=!1,ne(),o.phase=n,k.value=!0},O=n=>{g.value=!0,ee(n),k.value=!0},Z=async()=>{try{await Q.post("/projects",o),alert("\u65B0\u589E\u6210\u529F"),await y(),k.value=!1}catch{alert("\u65B0\u589E\u5931\u6557")}},ee=n=>{for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&Object.prototype.hasOwnProperty.call(n,l)&&(o[l]=n[l])},te=async()=>{const n={name:o.name,date:o.date,status:o.status,phase:o.phase,owner:{label:o.owner.label,value:o.owner.value},client:o.client,phone:o.phone,address:o.address,budget:o.budget,remark:o.remark};try{await Q.patch(`/projects/${o._id}`,n),alert("\u5132\u5B58\u6210\u529F"),k.value=!1,await y()}catch{alert("\u5132\u5B58\u5931\u6557")}},B=n=>{confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u5C08\u6848 "${n.name}" \uFF1F`)&&se(n._id)},se=async n=>{try{await Q.delete(`/projects/${n}`),alert("\u522A\u9664\u6210\u529F"),await y()}catch(l){console.log(l),alert("\u522A\u9664\u5931\u6557")}},S=n=>new Date(n).toLocaleDateString(),I=n=>({"status-preparing":n==="\u6E96\u5099\u4E2D","status-in-progress":n==="\u9032\u884C\u4E2D","status-done":n==="\u5DF2\u5B8C\u6210","status-expired":n==="\u5DF2\u903E\u671F"}),K=v(""),b=v([]),le=V(()=>w.value.filter(n=>n.phase==="\u63D0\u6848\u968E\u6BB5")),ae=V(()=>w.value.filter(n=>n.phase==="\u8A2D\u8A08\u968E\u6BB5")),oe=V(()=>w.value.filter(n=>n.phase==="\u5DE5\u7A0B\u968E\u6BB5")),A=n=>{K.value=n.phase,b.value=n},ne=()=>{o.name="",o.date="2024/02/01",o.status="\u6E96\u5099\u4E2D",o.phase="",o.owner="",o.client="",o.phone="",o.address="",o.budget="",o.remark=""},j=v(""),P=v(""),de=()=>{j.value="date"},ce=()=>{j.value="status"},G=n=>({\u5DF2\u903E\u671F:1,\u9032\u884C\u4E2D:2,\u6E96\u5099\u4E2D:3,\u5DF2\u5B8C\u6210:4})[n]||99,F=n=>{let l;switch(n){case"\u63D0\u6848\u968E\u6BB5":l=le.value.slice();break;case"\u8A2D\u8A08\u968E\u6BB5":l=ae.value.slice();break;case"\u5DE5\u7A0B\u968E\u6BB5":l=oe.value.slice();break;default:l=[]}return j.value==="date"?l.sort((t,c)=>new Date(t.date)-new Date(c.date)):j.value==="status"&&l.sort((t,c)=>G(t.status)-G(c.status)),P.value&&(l=l.filter(t=>t.name.includes(P.value))),l},re=ge(),z=n=>{re.push(`/ProjectControl/project/${n._id}`)},ue=V(()=>N("\u63D0\u6848\u968E\u6BB5")),ie=V(()=>N("\u8A2D\u8A08\u968E\u6BB5")),_e=V(()=>N("\u5DE5\u7A0B\u968E\u6BB5")),N=n=>w.value.filter(l=>l.phase===n).length,y=async()=>{try{const[n,l]=await Promise.all([Q.get("/users/all"),be.get("/projects/all")]),c=n.data.result.map(H=>({label:H.account,value:H._id}));q.value=c;const pe=l.data;w.value=pe.result}catch{alert("error")}};return y(),(n,l)=>(h(),U(me,{class:"flex flex-center"},{default:a(()=>[e("div",Ce,[je,e("div",Pe,[s(f,{color:"grey-7",round:"",flat:"",icon:"sort"},{default:a(()=>[u(" \u6392\u5E8F\u65B9\u5F0F "),s(D,{cover:"","auto-close":""},{default:a(()=>[s($,null,{default:a(()=>[s(_,{clickable:"",onClick:de},{default:a(()=>[s(i,null,{default:a(()=>[u("\u4F9D\u7167\u65E5\u671F\u6392\u5E8F")]),_:1})]),_:1}),s(_,{clickable:"",onClick:ce},{default:a(()=>[s(i,null,{default:a(()=>[u("\u4F9D\u7167\u72C0\u614B\u6392\u5E8F")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(m,{modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=t=>P.value=t),dense:"",clearable:"",class:"search"},{prepend:a(()=>[s(C,{name:"search"})]),_:1},8,["modelValue"])]),e("div",ye,[e("div",De,[s(p,{class:"show-card",flat:""},{default:a(()=>[s(r,null,{default:a(()=>[e("div",$e,[Qe,e("div",Ue,[e("div",xe,d(ue.value),1),Oe])]),s(C,{name:"add",onClick:l[1]||(l[1]=t=>x("\u63D0\u6848\u968E\u6BB5"))})]),_:1})]),_:1})]),e("div",Be,[(h(!0),L(M,null,R(F("\u63D0\u6848\u968E\u6BB5"),t=>(h(),U(p,{flat:"",class:"project-card",key:t._id,onClick:c=>A(t),onDblclick:c=>z(t)},{default:a(()=>[s(r,{class:"row"},{default:a(()=>[e("div",Se,[e("div",Ie,d(t.name),1),e("div",Ae,d(S(t.date)),1),e("div",Fe,[e("span",{class:T(I(t.status))},d(t.status),3)])]),e("div",ze,[s(f,{color:"grey-7",round:"",flat:"",icon:"more_horiz"},{default:a(()=>[s(D,{cover:"","auto-close":""},{default:a(()=>[s($,null,{default:a(()=>[s(_,{clickable:"",onClick:c=>O(t)},{default:a(()=>[s(i,null,{default:a(()=>[u("\u7DE8\u8F2F")]),_:1})]),_:2},1032,["onClick"]),s(_,{clickable:"",onClick:c=>B(t)},{default:a(()=>[s(i,null,{default:a(()=>[u("\u522A\u9664")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["onClick","onDblclick"]))),128))])]),e("div",Ne,[e("div",Ee,[s(p,{class:"show-card",flat:""},{default:a(()=>[s(r,null,{default:a(()=>[e("div",Le,[Re,e("div",Me,[e("div",Te,d(ie.value),1),qe])]),s(C,{name:"add",onClick:l[2]||(l[2]=t=>x("\u8A2D\u8A08\u968E\u6BB5"))})]),_:1})]),_:1})]),e("div",Ke,[(h(!0),L(M,null,R(F("\u8A2D\u8A08\u968E\u6BB5"),t=>(h(),U(p,{flat:"",class:"project-card",key:t._id,onClick:c=>A(t),onDblclick:c=>z(t)},{default:a(()=>[s(r,{class:"row"},{default:a(()=>[e("div",Ge,[e("div",He,d(t.name),1),e("div",Je,d(S(t.date)),1),e("div",We,[e("span",{class:T(I(t.status))},d(t.status),3)])]),e("div",Xe,[s(f,{color:"grey-7",round:"",flat:"",icon:"more_horiz"},{default:a(()=>[s(D,{cover:"","auto-close":""},{default:a(()=>[s($,null,{default:a(()=>[s(_,{clickable:"",onClick:c=>O(t)},{default:a(()=>[s(i,null,{default:a(()=>[u("\u7DE8\u8F2F")]),_:1})]),_:2},1032,["onClick"]),s(_,{clickable:"",onClick:c=>B(t)},{default:a(()=>[s(i,null,{default:a(()=>[u("\u522A\u9664")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["onClick","onDblclick"]))),128))])]),e("div",Ye,[e("div",Ze,[s(p,{class:"show-card",flat:""},{default:a(()=>[s(r,null,{default:a(()=>[e("div",et,[tt,e("div",st,[e("div",lt,d(_e.value),1),at])]),s(C,{name:"add",onClick:l[3]||(l[3]=t=>x("\u5DE5\u7A0B\u968E\u6BB5"))})]),_:1})]),_:1})]),e("div",ot,[(h(!0),L(M,null,R(F("\u5DE5\u7A0B\u968E\u6BB5"),t=>(h(),U(p,{flat:"",class:"project-card",key:t._id,onClick:c=>A(t),onDblclick:c=>z(t)},{default:a(()=>[s(r,{class:"row"},{default:a(()=>[e("div",nt,[e("div",dt,d(t.name),1),e("div",ct,d(S(t.date)),1),e("div",rt,[e("span",{class:T(I(t.status))},d(t.status),3)])]),e("div",ut,[s(f,{color:"grey-7",round:"",flat:"",icon:"more_horiz"},{default:a(()=>[s(D,{cover:"","auto-close":""},{default:a(()=>[s($,null,{default:a(()=>[s(_,{clickable:"",onClick:c=>O(t)},{default:a(()=>[s(i,null,{default:a(()=>[u("\u7DE8\u8F2F")]),_:1})]),_:2},1032,["onClick"]),s(_,{clickable:"",onClick:c=>B(t)},{default:a(()=>[s(i,null,{default:a(()=>[u("\u522A\u9664")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["onClick","onDblclick"]))),128))])]),e("div",it,[s(p,{class:"complete-card",flat:""},{default:a(()=>[s(r,null,{default:a(()=>[_t,s(Ve,{phase:K.value},null,8,["phase"]),e("div",pt,[e("div",mt,d(b.value.name),1),e("table",vt,[e("tr",ft,[ht,e("td",null,d(b.value.address),1)]),e("tr",kt,[bt,e("td",null,d(b.value.client),1)]),e("tr",Vt,[wt,e("td",null,d(b.value.phone),1)]),e("tr",gt,[Ct,e("td",null,d(b.value.budget),1)])])])]),_:1})]),_:1})])]),s(ke,{modelValue:k.value,"onUpdate:modelValue":l[16]||(l[16]=t=>k.value=t),persistent:""},{default:a(()=>[s(p,{class:"add-form"},{default:a(()=>[s(r,null,{default:a(()=>[e("div",jt,d(g.value?"\u7DE8\u8F2F\u5C08\u6848":"\u65B0\u589E\u5C08\u6848"),1)]),_:1}),s(r,null,{default:a(()=>[s(m,{modelValue:o.name,"onUpdate:modelValue":l[4]||(l[4]=t=>o.name=t),label:"\u5C08\u6848\u540D\u7A31"},null,8,["modelValue"]),s(m,{modelValue:o.date,"onUpdate:modelValue":l[6]||(l[6]=t=>o.date=t),mask:"date",rules:["date"]},{append:a(()=>[s(C,{name:"event",class:"cursor-pointer"},{default:a(()=>[s(ve,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[s(fe,{modelValue:o.date,"onUpdate:modelValue":l[5]||(l[5]=t=>o.date=t)},{default:a(()=>[e("div",Pt,[W(s(f,{label:"Close",color:"primary",flat:""},null,512),[[J]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(E,{modelValue:o.status,"onUpdate:modelValue":l[7]||(l[7]=t=>o.status=t),label:"\u5C08\u6848\u72C0\u614B",options:X},null,8,["modelValue"]),s(E,{modelValue:o.phase,"onUpdate:modelValue":l[8]||(l[8]=t=>o.phase=t),label:"\u5C08\u6848\u968E\u6BB5",options:Y},null,8,["modelValue"]),s(E,{modelValue:o.owner,"onUpdate:modelValue":l[9]||(l[9]=t=>o.owner=t),label:"\u5C08\u6848\u4E3B\u7BA1",options:q.value},null,8,["modelValue","options"]),s(m,{modelValue:o.client,"onUpdate:modelValue":l[10]||(l[10]=t=>o.client=t),label:"\u696D\u4E3B\u59D3\u540D"},null,8,["modelValue"]),s(m,{modelValue:o.phone,"onUpdate:modelValue":l[11]||(l[11]=t=>o.phone=t),label:"\u696D\u4E3B\u96FB\u8A71"},null,8,["modelValue"]),s(m,{modelValue:o.address,"onUpdate:modelValue":l[12]||(l[12]=t=>o.address=t),label:"\u5C08\u6848\u5730\u5740"},null,8,["modelValue"]),s(m,{modelValue:o.budget,"onUpdate:modelValue":l[13]||(l[13]=t=>o.budget=t),label:"\u5C08\u6848\u9810\u7B97"},null,8,["modelValue"]),s(m,{modelValue:o.remark,"onUpdate:modelValue":l[14]||(l[14]=t=>o.remark=t),label:"\u5099\u8A3B",type:"textarea",clearable:""},null,8,["modelValue"])]),_:1}),s(he,{align:"right"},{default:a(()=>[W(s(f,{class:"btn-cancel",flat:"",label:"\u53D6\u6D88"},null,512),[[J]]),s(f,{class:"btn-save",flat:"",label:g.value?"\u5132\u5B58":"\u65B0\u589E",onClick:l[15]||(l[15]=t=>g.value?te():Z())},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{At as default};
